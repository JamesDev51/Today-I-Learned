---
title: "k8s 아키텍처"
date: "2024-05-27"
lastmod: "2024-05-27"
summary: "k8s의 동작 원리, 컴포넌트"
description: "k8s가 어떻게 동작하는지, 구성하는 컴포넌트"
tags: ["k8s"]
categories: ["k8s"]
ShowToc: true
TocOpen: false
---

> 참고 강의
> 따배쿠(따라하며 배우는 쿠버네티스)

# 동작 flow
- image push까지
  1. docker push
  2. image is pushed to docker registry (ecr, dockerhub ... )
- k8s부터
  1. kubectl create deploy
  2. (Master node - Scheduler) kubectl issuses REST call
  3. (Master node - Scheduler) Pod created and scheduled to a workder node 
  4. (Workder node - kubelet) kubelet is notified
  5. (Workder node - docker, container runtime ...) docker run image 

# k8s 컴포넌트
## 마스터 컴포넌트
- etcd: key-value 타입의 저장소
- kube-apiserver: k8s API를 사용하도록 요청을 받고 요청이 유효한지 검사
- kube-scheduler: 파드를 실행할 노드를 선택
- kube-controller-manager: 파드를 관찰하며 개수를 보장함
## 워커 노트 컴포넌트
- kubelet
  - 모든 노드에서 실행되는 k8s 에이전트
  - 데몬 형태로 동작
- kube-proxy
  - k8s의 network 동작을 관리
  - iptables rule을 구성
- 컨테이너 런타임
  - 컨테이너를 실행하는 엔진
  - docker, containerd, runc
## 애드온
- 네트워크 애드온
  - CNI
    - weave
    - calico
    - flaneld
    - kube-route
    - ...
- dns 애드온 
  - coreDNS
- 대시보드 애드온
- 컨테이너 자원 모니터링
  - cAdvisor
- 클러스터 로깅
  - 컨테이너 로그, k8s 운영 로그들을 수집해서 중앙화
  - ELK, EFK, DataDog

# namespace
- 클러스터 하나를 여러 개의 논리적인 단위로 나눠서 사용하는 단위
- 용도에 따라 실행해야 하는 앱을 구분할 때 사용 

# API version
- k8s object 정의 시 apiVersion이 필요함
- update하는 API가 있으면 새로운 API가 생성됨
- alpha -> beta -> stable
- explain 명령어로 apiVersion 확인 가능